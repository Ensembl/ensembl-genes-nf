{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/nf-core/testpipeline/master/nextflow_schema.json",
  "title": "Pipeline to run BUSCO (protein and/or genome mode) and/or Omark.",
  "description": "Define the parameters to run the BUSCO & coredb metadata patching pipeline",
  "type": "object",
  "$defs": {
    "main_parameters": {
      "title": "Input/output parameters [REQUIRED]:",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Define key params the pipeline requires before initializing.",
      "required": ["enscode", "bioperl", "outDir", "csvFile"],
      "properties": {
        "enscode": {
          "type": "string",
          "format": "directory-path",
          "description": "env ENSCODE path.",
          "fa_icon": "fas fa-folder-open"
        },
        "bioperl": {
          "type": "string",
          "format": "directory-path",
          "description": "Path to the directory containing the BioPerl library.",
          "fa_icon": "fas fa-folder-open"
        },
        "outDir": {
          "type": "string",
          "format": "directory-path",
          "description": "Output directory used to store finalized pipeline data.",
          "fa_icon": "fas fa-folder-open"
        },
        "csvFile": {
          "type": "string",
          "format": "file-path",
          "exists": true,
          "mimetype": "text/csv",
          "schema": "input_csv_schema.json",
          "description": "Path for the input csv file containing the db name(s).",
          "fa_icon": "fas fa-file-csv"
        }
      },
      "dependentRequired": {
        "bioperl": ["enscode"]
      }
    },
    "workflow_parameters": {
      "title": "General workflow parameters:",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Parameters required for the workflow to be configured regarding optional processing.",
      "properties": {
        "run_busco_core": {
          "type": "boolean",
          "description": "Run BUSCO given a mysql db.",
          "help_text": "(protein or genome mode see '--busco_mode').",
          "fa_icon": "fas fa-question-circle"
        },
        "run_busco_ncbi": {
          "type": "boolean",
          "description": "Run BUSCO given a assembly_accession and taxonomy id in genome mode only.",
          "fa_icon": "fas fa-question-circle"
        },
        "run_omark": {
          "type": "boolean",
          "description": "Run OMARK given a mysql db, default false",
          "fa_icon": "fas fa-question-circle"
        },
        "run_ensembl_stats": {
          "type": "boolean",
          "description": "Run Ensembl statistics given a mysql db",
          "fa_icon": "fas fa-question-circle"
        },
        "apply_busco_metakeys": {
          "type": "boolean",
          "description": "Create JSON file with BUSCO metakeys and load it into the db.",
          "fa_icon": "fas fa-question-circle"
        },
        "apply_ensembl_stats": {
          "type": "boolean",
          "description": "Insert Ensembl statistics into a mysql db",
          "fa_icon": "fas fa-question-circle"
        },
        "run_ensembl_beta_metakeys": {
          "type": "boolean",
          "description": "Run Ensembl beta metakeys given a mysql db.",
          "fa_icon": "fas fa-question-circle"
        },
        "apply_ensembl_beta_metakeys": {
          "type": "boolean",
          "description": "Insert Ensembl beta metakeys into a mysql db.",
          "fa_icon": "fas fa-question-circle"
        },
        "host": {
          "type": "string",
          "description": "Full mysql host database name."
        },
        "port": {
          "type": "integer",
          "description": "Four digit port number for specified mysql DB host."
        },
        "password": {
          "type": "string",
          "description": "Password for MYSQL write-enabled host connection."
        },
        "server_set": {
          "type": "string",
          "description": "Specific MYSQL write user.",
          "enum": ["ensadmin","ensrw"],
          "help_text": "Related to host server specified: param '--host'."
        },
        "team": {
          "type": "string",
          "description": "Required CoreDB meta_key for data team responsible.",
          "enum": ["genebuild","metazoa","plants","microbes"],
          "help_text": "When 'run_ensembl_beta_metakeys' is enabled this key must be set."
        }
      },
      "dependentRequired": {
        "run_ensembl_beta_metakeys": ["team"],
        "run_busco_core": ["host","port","password","server_set"],
        "run_omark": ["host","port","password","server_set"]
      }
    },
    "optional_parameters": {
      "title": "Optional parameters:",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Optional parameters defined with defaults but can be altered.",
      "properties": {
        "user_w": {
          "type": "string",
          "description": "DB write user name.",
          "enum": ["ensadmin","ensrw"]
        },
        "user_r": {
          "type": "string",
          "description": "DB read_only user."
        },
        "project": {
          "type": "string",
          "description": "Project for the formatting of the output.",
          "enum": ["ensembl","brc"]
        },
        "metatable_keys": {
          "type": "string",
          "format": "file-path",
          "description": "Location of flat file (.txt) containing CoreDB meta table meta_keys.",
          "fa_icon": "fas fa-folder-open",
          "hidden": true
        },
        "cacheDir": {
          "type": "string",
          "format": "directory-path",
          "description": "The path where downloaded files will be cached.",
          "fa_icon": "fas fa-folder-open"
        },
        "cleanCache": {
          "type": "boolean",
          "description": "Purge cache_dir if it exists.",
          "fa_icon": "fas fa-folder-open",
          "hidden": true
        }
      }
    },
    "advanced_parameters": {
      "title": "Advanced parameters:",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Important configuration setup. Not to be changed unless confident on config changes.",
      "properties": {
        "canonical_only": {
          "type": "string",
          "description": "Enable 'canonical only' sequence dumps.",
          "fa_icon": "fas fa-cog"
        },
        "ncbiBaseUrl": {
          "type": "string",
          "format": "https://.+/",
          "description": "Rest API for NCBI datasets v2alpha.",
          "fa_icon": "fas fa-cog",
          "hidden": true
        },
        "genomio_version":{
          "type": "string",
          "description": "Ensembl-genomio Python library container.",
          "fa_icon": "fas fa-cog"
        },
        "files_latency": {
          "type": "integer",
          "format": "[0-9]+",
          "description": "Sleep time (seconds) after genome and proteins have been fetched.",
          "help_text": "Needed by several file systems due to their internal latency.",
          "fa_icon": "fas fa-folder-open",
          "hidden": true
        },
        "mysql_cmds": {
          "type": "string",
          "format": "directory-path",
          "description": "Location of HPS user mysql-cmds.",
          "fa_icon": "fas fa-folder-open",
          "hidden": true
        },
        "mysql_ensadmin": {
          "type": "string",
          "description": "Default user mysql user.",
          "fa_icon": "fas fa-folder-open",
          "hidden": true
        }
      }
    },
    "busco_configuration": {
      "title": "BUSCO specific config setup:",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Regulated/Hidden parameters not shown (show with --validationShowHiddenParams).",
      "properties": {
        "busco_mode": {
          "type": "string",
          "uniqueItems": true,
          "items": {
            "enum": ["protein", "genome", "genome,protein", "protein,genome"]
          },
          "description": "The mode in which to run BUSCO.",
          "help_text": "If unspecified the pipeline runs in both genome and protein modes.",
          "fa_icon": "fas fa-users-cog"
        },
        "busco_dataset": {
          "type": "string",
          "format": "[a-z]+_odb10",
          "description": "User override to explicitly specify the BUSCO dataset.",
          "help_text": "Corresponds to a orthoDB lineage set.",
          "fa_icon": "fas fa-users-cog",
          "hidden": true
        },
        "busco_version": {
          "type": "string",
          "format": "v([0-9]+).([0-9]+).([0-9]+)_[a-z]+[0-9]+$",
          "description": "BUSCO version to use.",
          "help_text": "BUSCO version corresponding to docker container 'ezlabgva/busco:${params.busco_version}'",
          "fa_icon": "fas fa-cog",
          "hidden": true
        },
        "download_path": {
          "type": "string",
          "format": "directory-path",
          "description": "Location of pre-downloaded lineage datasets.",
          "fa_icon": "fas fa-cog",
          "hidden": true
        },
        "busco_datasets_file": {
          "type": "string",
          "format": "file-path",
          "exists": true,
          "description": "Location of pre-downloaded lineage datasets.",
          "fa_icon": "fas fa-cog",
          "hidden": true
        }
      }
    },
    "omark_configuration": {
      "title": "OMARK specific config setup.",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Regulated/Hidden parameters not shown (show with --validationShowHiddenParams).",
      "properties": {
        "omamer_database": {
          "type": "string",
          "format": "file-path",
          "description": "Location of Omark omamer_db on production file system.",
          "fa_icon": "fas fa-cog",
          "hidden": true
        },
        "omark_singularity_path": {
          "type": "string",
          "format": "file-path",
          "exists": true,
          "description": "Location of Omark specific singularity SIF image.",
          "fa_icon": "fas fa-cog",
          "hidden": true
        }
      }
    }
  },
  "allOf": [
    {
      "$ref": "#/$defs/main_parameters"
    },
    {
      "$ref": "#/$defs/workflow_parameters"
    },
    {
      "$ref": "#/$defs/optional_parameters"
    },
    {
      "$ref": "#/$defs/advanced_parameters"
    },
    {
      "$ref": "#/$defs/busco_configuration"
    },
    {
      "$ref": "#/$defs/omark_configuration"
    }
  ]
}
